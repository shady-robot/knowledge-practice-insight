# Prometheus

## PromQL

通过PromQL我们可以非常方便的对数据进行查询，过滤，以及聚合，计算等操作。通过这些丰富的表达书语
句，监控指标不再是一个单独存在的个体，而是一个个能够表达出正式业务含义的语言。

## 理解时间序列

### 样本

Prometheus 会将所有采集到的样本数据以时间序列的方式保存在内存数据库中，并且定时保存到硬盘上。
time-series 是按照时间戳和值的序列顺序存放的，我们称之为向量(vector)。 每条 time-series
通过指标名称（metrics name）和一组标签集（labelsets）命名。

在 time-series 中的每一个点称为一个样本（sample），样本由以下三部分组成：

* 指标(metric): metric name 描述当前样本特征的 labelsets
* 时间戳(timestamp): 一个精准到毫秒的时间戳
* 样本值(value): 一个 float64 的浮点型数据表示当前样本的值

### 数据类型

为了能够帮助用户理解和区分这些不同监控指标之间的差异，Prometheus定义了4种不同的指标类型
(metric type)：Counter（计数器）、Gauge（仪表盘）、Histogram（直方图）、Summary（摘要）

#### 使用Histogram和Summary分析数据分布情况

在大多数情况下人们都倾向于使用某些量化指标的平均值，例如CPU的平均使用率、页面的平均响应时间。
这种方式的问题很明显，以系统API调用的平均响应时间为例：如果大多数API请求都维持在100ms的响应时
间范围内，而个别请求的响应时间需要5s，那么就会导致某些WEB页面的响应时间落到中位数的情况，而这种
现象被称为长尾问题。
为了区分是平均的慢还是长尾的慢，最简单的方式就是按照请求延迟的范围进行分组。例如，统计延迟在
0~10ms之间的请求数有多少而10~20ms之间的请求数又有多少。通过这种方式可以快速分析系统慢的原因。
Histogram和Summary都是为了能够解决这样问题的存在，通过Histogram和Summary类型的监控指标，
我们可以快速了解监控样本的分布情况。
